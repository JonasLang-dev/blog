---
slug: bing_maps_api
title: 在React中使用bing maps api
authors: jonas
tags: [bing maps api, react]
---

## 引言

此博客作为一份如何在React中使用bing maps api参考，其他地图api原理上也可参考此教程。

## 前期准备

首先需要在[bing mpas dev center](https://www.bingmapsportal.com/)中，具体在My accout下My keys中创建new key。

![bing map create key](/img/bingmapscreatekey.png)

Application URL作为可选项，若填写url相当于白名单。非此域名下的网站则无法通过此key获取对应的一些api操作。

创建后key details下面key默认隐藏点击Show key便可拿到所需要的bing maps api中的key。

![bing maps key detail](/img/bingmapskeyinfo.png)


开发者文档：

* [Bing maps dev center技术文档](https://cn.bing.com/maps/sdkrelease/mapcontrol/isdk/Overview)

* [Microsoft技术文档中关于bing maps](https://learn.microsoft.com/bingmaps/)

## 加载bing maps api script

该教程以bing maps v8组件为例子

首先需要在React中有两种方式引入第三方引入第三方js资源：

* 通常React项目中直接在index.html中通过script标签引入

``` html
<script type='text/javascript' src='http://www.bing.com/api/maps/mapcontrol?callback=GetMap&branch=experimental&key=[YOUR_BING_MAPS_KEY]' async defer></script>
```

* 由于某些情况该工程不包含index.html或者其他因素则需要dom操作。需要注意以下事项。
  * bing map script资源推荐全局引用，若在对应组件再加载scipt资源此时会极大影响体验。操作起来也会更为繁琐（需要留意是在地图资源加载完成后才进行初始化地图；由于是组件挂载bing maps script资源，每次组件卸载scipt资源也会被卸载，意味着每次组件加载时都需要获取一遍script资源）
  * 推荐dom操作时，在body中插入scipt资源

以下是我的片段代码（自定义hook）

``` jsx
import { useEffect } from 'react'

/**
 * useLoadMap hook
 * @description 加载bing map script资源
 * @returns {void}
 */
const useLoadMap = () => {
  useEffect(() => {
    if (!window.Microsoft) {
      const script = document.createElement('script')
      script.src = `https://www.bing.com/api/maps/mapcontrol?key=${BING_KEY}`
      script.async = true
      script.defer = true
      script.type = 'text/javascript'
      document.body.appendChild(script)
    }
  }, [window.Microsoft])
}

export default useLoadMap
```

引用

``` jsx
// ...app

// ...
useLoadMap()
// ...
```

[bing maps script参数](https://learn.microsoft.com/en-us/bingmaps/v8-web-control/creating-and-hosting-map-controls/setting-map-control-parameters)

## 初始化bing map

## 配置

### 图钉

### 事件
